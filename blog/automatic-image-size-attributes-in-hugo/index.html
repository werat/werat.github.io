<!doctype html><html lang=en><head><title>Automatic image size attributes in Hugo</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Andy Hippo"><meta name=description content="It&rsquo;s a good practice to always include width and height attributes on images and video elements. Without them the browser has no way of knowing how large the image is going to be and cannot reserve the space in advance when rendering the page. This often leads to the content moving around during the page load, since images take extra time to fetch. This is called Layout Shift and I find it extremely annoying!"><meta name=keywords content="blog,developer,personal,hugo,performace,web"><meta name=twitter:card content="summary"><meta name=twitter:title content="Automatic image size attributes in Hugo"><meta name=twitter:description content="It&rsquo;s a good practice to always include width and height attributes on images and video elements. Without them the browser has no way of knowing how large the image is going to be and cannot reserve the space in advance when rendering the page. This often leads to the content moving around during the page load, since images take extra time to fetch. This is called Layout Shift and I find it extremely annoying!"><meta property="og:title" content="Automatic image size attributes in Hugo"><meta property="og:description" content="It&rsquo;s a good practice to always include width and height attributes on images and video elements. Without them the browser has no way of knowing how large the image is going to be and cannot reserve the space in advance when rendering the page. This often leads to the content moving around during the page load, since images take extra time to fetch. This is called Layout Shift and I find it extremely annoying!"><meta property="og:type" content="article"><meta property="og:url" content="https://werat.dev/blog/automatic-image-size-attributes-in-hugo/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-30T12:00:00+01:00"><meta property="article:modified_time" content="2023-04-30T12:00:00+01:00"><link rel=canonical href=https://werat.dev/blog/automatic-image-size-attributes-in-hugo/><link rel=alternate type=application/rss+xml title=werat.dev href=https://werat.dev/index.xml><link rel=icon href=/favicon.ico sizes=any><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=manifest href=/manifest.webmanifest><link rel=stylesheet href=/css/main.css><meta name=generator content="Hugo 0.111.3"></head><body><header class=nav-header><nav><span class=nav-title><a href=/>werat.dev</a></span>
<a href=/posts/>Blog</a>
<a href=/talks/>Talks</a></nav></header><main><article><header><h1 class=title>Automatic image size attributes in Hugo</h1><time class=posted-on datetime=2023-04-30T12:00:00+01:00>April 30, 2023</time></header><p>It&rsquo;s <a href=https://web.dev/optimize-cls/#images-without-dimensions>a good practice</a> to always include <code>width</code> and <code>height</code> attributes on images and video elements. Without them the browser has no way of knowing how large the image is going to be and cannot reserve the space in advance when rendering the page. This often leads to the content moving around during the page load, since images take extra time to fetch. This is called <a href=https://web.dev/cls/>Layout Shift</a> and I find it extremely annoying!</p><p>This website is built with <a href=https://gohugo.io/>Hugo</a> and one of the first things I noticed after running the <a href=https://pagespeed.web.dev/>PageSpeed Insights</a> analyzer is that it actually doesn&rsquo;t set the size attributes on <code>&lt;img></code> tags! The website content is written in markdown (e.g. <a href=https://github.com/werat/werat.github.io/blob/956954c4c00055428167c3677d129c2a530e4848/content/posts/2023-04-30-automatic-image-size-attributes-in-hugo/index.md>this post</a>), so in the source code it looks just like this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>![<span style=color:#000>AltText</span>](<span style=color:#836c28>image.png</span>)
</span></span></code></pre></div><p>When building the website Hugo uses the markdown renderer to produce the corresponding HTML, which would look like this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#000>img</span> <span style=color:#836c28>src</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;image.png&#34;</span> <span style=color:#836c28>alt</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;AltText&#34;</span>&gt;
</span></span></code></pre></div><p>As you can see, no <code>width</code> and <code>height</code> size attributes here. I&rsquo;m not really sure why Hugo doesn&rsquo;t include them by default. Maybe it&rsquo;s because the referenced image might be malformed or even not exist, but in my blog I have control over the data and I prefer to have these attributes to be always present.</p><h2 id=using-markdown-render-hooks>Using markdown render hooks</h2><p>The Markdown renderer used by Hugo supports <a href=https://gohugo.io/templates/render-hooks/>render hooks</a>, which allow the user to override markdown rendering functionality. In particular we can provide a custom template and replace the default boring image rendering logic with our own smart size-attributes-providing one.</p><p>The image render hook should be defined in <code>layouts/_default/_markup/render-image.html</code>. You can have different hooks for different sections and output formats, but I don&rsquo;t really care about that for my simple blog. Extracting the image dimentions is pretty simple, so the whole template is quite short:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>{{- $image := .Page.Resources.GetMatch (printf &#34;%s&#34; (.Destination | safeURL)) -}}
</span></span><span style=display:flex><span>&lt;<span style=color:#000>img</span>
</span></span><span style=display:flex><span>    <span style=color:#836c28>src</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;{{ .Destination | safeURL }}&#34;</span> <span style=color:#836c28>alt</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;{{ .Text }}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>{{</span> <span style=color:#836c28>with</span> <span style=color:#000>$</span><span style=color:#836c28>image</span> <span style=color:#000>}}</span>
</span></span><span style=display:flex><span>    <span style=color:#836c28>width</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;{{ $image.Width }}&#34;</span> <span style=color:#836c28>height</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;{{ $image.Height }}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>{{</span> <span style=color:#836c28>end</span> <span style=color:#000>}}</span> /&gt;
</span></span></code></pre></div><p>This template was perfect for me for a while, but at some point I wanted to set the <code>max-width</code> property, because some images were too big. There&rsquo;s no good way to pass the arbitrary parameters to the render template, but luckily the markdown syntax for images allows providing an image &ldquo;title&rdquo;:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>![<span style=color:#000>AltText</span>](<span style=color:#836c28>image.png &#34;Title&#34;</span>)
</span></span></code></pre></div><p>I don&rsquo;t set titles for my images, so instead I repurposed this parameter for setting the maximum width:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>{{- $image := .Page.Resources.GetMatch (printf &#34;%s&#34; (.Destination | safeURL)) -}}
</span></span><span style=display:flex><span>&lt;<span style=color:#000>img</span>
</span></span><span style=display:flex><span>    <span style=color:#836c28>src</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;{{ .Destination | safeURL }}&#34;</span> <span style=color:#836c28>alt</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;{{ .Text }}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>{{</span> <span style=color:#836c28>with</span> <span style=color:#000>$</span><span style=color:#836c28>image</span> <span style=color:#000>}}</span>
</span></span><span style=display:flex><span>    <span style=color:#836c28>width</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;{{ $image.Width }}&#34;</span> <span style=color:#836c28>height</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;{{ $image.Height }}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>{{</span> <span style=color:#836c28>end</span> <span style=color:#000>}}</span>
</span></span><span style=display:flex><span>    <span style=color:#000>{{</span> <span style=color:#836c28>with</span> <span style=color:#000>.</span><span style=color:#836c28>Title</span><span style=color:#000>}}</span> <span style=color:#836c28>style</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;width: 100%; max-width: {{ . }};&#34;</span><span style=color:#000>{{</span> <span style=color:#836c28>end</span> <span style=color:#000>}}</span>
</span></span><span style=display:flex><span>    /&gt;
</span></span></code></pre></div><p>With this template the size attributes are provided automatically and <code>max-width</code> is set conditionally, if the &ldquo;title&rdquo; is provided. So now <code>![AltText](image.png "500px")</code> is rendered like this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#000>img</span>
</span></span><span style=display:flex><span>    <span style=color:#836c28>src</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;image.png&#34;</span> <span style=color:#836c28>alt</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;AltText&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#836c28>width</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;667&#34;</span> <span style=color:#836c28>height</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;375&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#836c28>style</span><span style=color:#000>=</span><span style=color:#c41a16>&#34;width: 100%; max-width: 570px;&#34;</span>/&gt;
</span></span></code></pre></div><p>Here&rsquo;s the final template used for this website &ndash; <a href=https://github.com/werat/werat.github.io/blob/faa5bab6f6498b25ce0df1c261e16af7fa881f9d/layouts/_default/_markup/render-image.html>layouts/_default/_markup/render-image.html</a>.</p></article></main><footer>© 2017 - 2023 <a href=mailto:weratt@gmail.com>Andy Hippo</a>
(<a href=https://twitter.com/werat>@werat</a>)
· Licensed under <a href=https://github.com/werat/werat.github.io/blob/main/LICENSE>MIT</a></footer><script data-goatcounter=https://werat-dev.goatcounter.com/count async src=//gc.zgo.at/count.js></script></body></html>