<!doctype html><html lang=en><head><title>Why are my PCHs out of date? · Reboot and Shine</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Andy Hippo"><meta name=description content="Last week I got an interesting bug report from a colleague. They were minding their own business and playing with Unreal Engine 5 when suddenly a wild build error appeared and said that some precompiled headers are out of date:
fatal error: file 'D:\toolchain\sysroot\usr\include\x86_64-linux-gnu\bits\wordsize.h' has been modified since the precompiled header 'UE5\Engine\...\SharedPCH.CoreUObject.ShadowErrors.h.gch' was built: mtime changed Hmm, well, it looks like some source files have changed and a simple re-build would fix the issue."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Why are my PCHs out of date?"><meta name=twitter:description content="Last week I got an interesting bug report from a colleague. They were minding their own business and playing with Unreal Engine 5 when suddenly a wild build error appeared and said that some precompiled headers are out of date:
fatal error: file 'D:\toolchain\sysroot\usr\include\x86_64-linux-gnu\bits\wordsize.h' has been modified since the precompiled header 'UE5\Engine\...\SharedPCH.CoreUObject.ShadowErrors.h.gch' was built: mtime changed Hmm, well, it looks like some source files have changed and a simple re-build would fix the issue."><meta property="og:title" content="Why are my PCHs out of date?"><meta property="og:description" content="Last week I got an interesting bug report from a colleague. They were minding their own business and playing with Unreal Engine 5 when suddenly a wild build error appeared and said that some precompiled headers are out of date:
fatal error: file 'D:\toolchain\sysroot\usr\include\x86_64-linux-gnu\bits\wordsize.h' has been modified since the precompiled header 'UE5\Engine\...\SharedPCH.CoreUObject.ShadowErrors.h.gch' was built: mtime changed Hmm, well, it looks like some source files have changed and a simple re-build would fix the issue."><meta property="og:type" content="article"><meta property="og:url" content="https://werat.dev/blog/why-are-my-pchs-out-of-date/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-04T13:35:00+01:00"><meta property="article:modified_time" content="2021-12-04T13:35:00+01:00"><link rel=canonical href=https://werat.dev/blog/why-are-my-pchs-out-of-date/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.c4d7e93a158eda5a65b3df343745d2092a0a1e2170feeec909b8a89443903c6a.css integrity="sha256-xNfpOhWO2lpls980N0XSCSoKHiFw/u7JCbiolEOQPGo=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/custom.min.3a66cc83b990cd6dcf6ee255edb3772f393c19e0bcd1c29c79805d1de9fa3841.css integrity="sha256-OmbMg7mQzW3PbuJV7bN3Lzk8GeC80cKceYBdHen6OEE=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/img/logo-avatar-32.png sizes=32x32><link rel=icon type=image/png href=/img/logo-avatar-16.png sizes=16x16><link rel=apple-touch-icon href=/img/logo-avatar.png><link rel=apple-touch-icon sizes=180x180 href=/img/logo-avatar.png><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.104.3"></head><body class="preload-transitions colorscheme-light"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Reboot and Shine</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/talks/>Talks</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://werat.dev/blog/why-are-my-pchs-out-of-date/>Why are my PCHs out of date?</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2021-12-04T13:35:00+01:00>December 4, 2021</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
4-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/unreal-engine/>unreal engine</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/clang/>clang</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/msi/>msi</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/windows-installer/>windows installer</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/windows/>windows</a></span></div></div></header><div><p>Last week I got an interesting bug report from a colleague. They were minding their own business and playing with Unreal Engine 5 when suddenly a wild build error appeared and said that some precompiled headers are out of date:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>fatal error: file <span style=color:#4070a0>&#39;D:\toolchain\sysroot\usr\include\x86_64-linux-gnu\bits\wordsize.h&#39;</span> has been
</span></span><span style=display:flex><span>modified since the precompiled header <span style=color:#4070a0>&#39;UE5\Engine\...\SharedPCH.CoreUObject.ShadowErrors.h.gch&#39;</span>
</span></span><span style=display:flex><span>was built: mtime changed
</span></span></code></pre></div><p>Hmm, well, it looks like some source files have changed and a simple re-build would fix the issue. However, building Unreal Engine from scratch takes <strong>considerable</strong> time, so you can understand why we&rsquo;d like to avoid that.</p><p>The toolchain and the sysroot are distributed via the SDK™ and the colleague claimed that the error happened after they&rsquo;ve installed a new version of the SDK. I was fairly sure that the above mentioned header files didn&rsquo;t actually change &ndash; it&rsquo;s a toolchain sysroot, it hasn&rsquo;t been touched in years. Indeed, a simple <code>stat</code> shows that the modification time goes back to 2018:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>&gt; stat <span style=color:#4070a0>&#34;D:\toolchain\sysroot\usr\include\x86_64-linux-gnu\bits\wordsize.h&#34;</span>
</span></span><span style=display:flex><span>  File<span>:</span> D:\toolchain\sysroot\usr\include\<span style=color:#007020>x86_64-linux</span>-gnu\bits\wordsize.<span style=color:#007020>h
</span></span></span><span style=display:flex><span><span style=color:#007020></span>  Size<span>:</span> 327             Blocks<span>:</span> 1          IO Block<span>:</span> 65536  regular file
</span></span><span style=display:flex><span>Device<span>:</span> eab6ee59h/3937857113d   Inode<span>:</span> 8162774325601647  Links<span>:</span> 1
</span></span><span style=display:flex><span>Access<span>:</span> (0644/-rw-r--r--)  Uid<span>:</span> (2249065/   werat)   Gid<span>:</span> (1049089/ UNKNOWN)
</span></span><span style=display:flex><span>Access<span>:</span> 2021-12-02 13<span>:</span>58<span>:</span>10.281221500 +0100
</span></span><span style=display:flex><span>Modify<span>:</span> 2018-01-14 10<span>:</span>39<span>:</span>44.000000000 +0100  <span style=color:#60a0b0;font-style:italic># Note: 2018-01-14 09:39:44 UTC</span>
</span></span><span style=display:flex><span>Change<span>:</span> 2021-12-02 13<span>:</span>58<span>:</span>10.281221500 +0100
</span></span><span style=display:flex><span> Birth<span>:</span> 2018-01-14 10<span>:</span>39<span>:</span>44.000000000 +0100
</span></span></code></pre></div><p>But surprisingly right after I installed the new SDK, I was getting the same build error too. Oh boy, this is going to be interesting. Down to the rabbit hole!</p><img src=quick-adventure.jpg alt="quick adventure meme" style=max-width:500px;width:100%><hr><p>The error we&rsquo;re seeing when building Unreal is coming from <code>clang</code> &ndash; the compiler complains that some of the input files of the precompiled header have been modified (i.e. their <code>mtime</code> is different from what is stored in the PCH). Let&rsquo;s peek inside the the PCH and see whether they are actually different:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># Dump the contents of the PCH (https://clang.llvm.org/docs/PCHInternals.html#ast-file-contents)</span>
</span></span><span style=display:flex><span><span style=color:#007020>llvm-bcanalyzer</span>.exe <span style=color:#4070a0>&#34;UE5\Engine\...\SharedPCH.CoreUObject.ShadowErrors.h.gch&#34;</span> --dump | less
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>&lt;INPUT_FILE abbrevid=4 op0=472 op1=327 op2=1515919184 op3=0 op4=0 op5=0/&gt; blob data = <span style=color:#4070a0>&#39;D:\toolchain\sysroot\usr\include\x86_64-linux-gnu\bits\wordsize.h&#39;</span>
</span></span></code></pre></div><p>It&rsquo;s size is <code>327</code> bytes (op1), and modification time is <code>1515919184</code> (op2), which corresponds to <code>2018-01-14 08:39:44 UTC</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#666>&gt;&gt;</span> <span style=color:#007020;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>datetime</span> <span style=color:#007020;font-weight:700>import</span> datetime, timezone
</span></span><span style=display:flex><span><span style=color:#666>&gt;&gt;</span> datetime<span style=color:#666>.</span>fromtimestamp(<span style=color:#40a070>1515919184</span>, tz<span style=color:#666>=</span>timezone<span style=color:#666>.</span>utc)
</span></span><span style=display:flex><span>datetime<span style=color:#666>.</span>datetime(<span style=color:#40a070>2018</span>, <span style=color:#40a070>1</span>, <span style=color:#40a070>14</span>, <span style=color:#40a070>8</span>, <span style=color:#40a070>39</span>, <span style=color:#40a070>44</span>, tzinfo<span style=color:#666>=</span>datetime<span style=color:#666>.</span>timezone<span style=color:#666>.</span>utc)
</span></span></code></pre></div><p>To summarize what we know so far:</p><ul><li><strong>wordsize.h (from PCH)</strong><ul><li>size &ndash; 327 bytes</li><li>mtime &ndash; 1515919184 (<code>2018-01-14 08:39:44 +0000</code>)</li></ul></li><li><strong>wordsize.h (on disk)</strong><ul><li>size &ndash; 327 bytes</li><li>mtime &ndash; 1515922784 (<code>2018-01-14 09:39:44 +0000</code>)</li></ul></li></ul><p>The file size matches as well as the contents, I&rsquo;ve checked separately. The source files used to build the precompiled header appear to be exactly the same, no <em>real</em> modifications has been made to them. However the <code>mtime</code> is indeed different (the compiler didn&rsquo;t lie).</p><p>Well, I did install a newer version of the SDK recently. The sysroot headers obviously didn&rsquo;t change &ndash; we can see they&rsquo;re are the same. Maybe the <code>mtime</code> got messed up in the newer SDK? Nope, I&rsquo;ve tried installing several different versions, but <code>mtime</code> of that file was always the same.</p><p>It&rsquo;s curious though that the timestamps are different by exactly one hour. When two timestamps are different by exactly N hours programmers usually get real suspicious&mldr;</p><img src=its-always-you-three.jpg alt="its always you three meme" style=max-width:500px;width:100%><hr><p>The SDK is distributed via the Windows Installer (MSI). And it turns out, Windows Installer adjusts the modification time of the files according to the local timezone of the target machine! It means that the actual file <code>mtime</code> will be different on different machines depending on their timezone, for example:</p><ul><li>Build server has UTC+0, the <code>mtime</code> of <code>wordsize.h</code> is <code>2018-01-14 10:00:00</code>.</li><li>Developer machine has UTC+1, the <code>mtime</code> of <code>wordsize.h</code> is <code>2018-01-14 09:00:00</code> (!!).</li></ul><p>Windows Explorer and other tools (e.g. <code>stat</code>) always display the local time, so both build server and the developer machine will show <code>2018-01-14 10:00:00</code>, but with a different offset, of course. However Windows Explorer doesn&rsquo;t show offsets or timezone, so for the user will just see the same modification time on both machines.</p><p>Same files, same installer, but the <code>mtime</code> will be different depending on your local timezone:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># Let&#39;s say we&#39;re in Berlin, UTC+1</span>
</span></span><span style=display:flex><span>&gt; stat <span style=color:#4070a0>&#34;D:\toolchain\sysroot\usr\include\x86_64-linux-gnu\bits\wordsize.h&#34;</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Modify<span>:</span> 2018-01-14 10<span>:</span>39<span>:</span>44.000000000 +0100
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># Aaaand now we&#39;re in Moscow, UTC+3</span>
</span></span><span style=display:flex><span>&gt; stat <span style=color:#4070a0>&#34;D:\toolchain\sysroot\usr\include\x86_64-linux-gnu\bits\wordsize.h&#34;</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Modify<span>:</span> 2018-01-14 10<span>:</span>39<span>:</span>44.000000000 +0300
</span></span></code></pre></div><p>Typically this wouldn&rsquo;t cause an issue &ndash; if local time is always the same, the timestamp will match. But wait-a-minute&mldr; what about the <strong>Daylight Saving Time</strong>? It changes the timezone offset and the files installed after the DST will have different <code>mtime</code> compared to the files installed before the DST.</p><p>I don&rsquo;t know whether it&rsquo;s a bug or a feature, but my guess it&rsquo;s unlikely to be fixed anytime soon because backwards compatibility™. And that means that twice a year our users might need to rebuild their code just because. That&rsquo;s why we can&rsquo;t have nice things ¯\_(ツ)_/¯</p><p>Unfortunately I haven&rsquo;t found a good way to alter this behaviour. <a href="https://www.advancedinstaller.com/forums/viewtopic.php?t=45880">Other people ran into this problem as well</a>, but no solutions have been posted. It&rsquo;s certainly possible to add a custom step to the installer to walk over the files and &ldquo;correct&rdquo; their <code>mtime</code>, but who knows what else might break because of this. If you know a better way, please, send help!</p><hr><p>Discuss this article on <a href=https://lobste.rs/s/qisivk/why_are_my_pchs_out_date>lobste.rs</a></p><hr></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2017 -
2022
Andy Hippo
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a></section></footer></main><script data-goatcounter=https://werat-dev.goatcounter.com/count>(function(){"use strict";window.goatcounter&&window.goatcounter.vars?window.goatcounter=window.goatcounter.vars:window.goatcounter=window.goatcounter||{};var e,t,n,o,i,a,r,c,l,d,u,s=document.querySelector("script[data-goatcounter]");if(s&&s.dataset.goatcounterSettings){try{o=JSON.parse(s.dataset.goatcounterSettings)}catch(e){console.error("invalid JSON in data-goatcounter-settings: "+e)}for(i in o)["no_onload","no_events","allow_local","allow_frame","path","title","referrer","event"].indexOf(i)>-1&&(window.goatcounter[i]=o[i])}e=encodeURIComponent,l=function(e){var s,o,i,t={p:e.path===void 0?goatcounter.path:e.path,r:e.referrer===void 0?goatcounter.referrer:e.referrer,t:e.title===void 0?goatcounter.title:e.title,e:!!(e.event||goatcounter.event),s:[window.screen.width,window.screen.height,window.devicePixelRatio||1],b:d(),q:location.search};return typeof t.r=="function"&&(s=t.r),typeof t.t=="function"&&(i=t.t),typeof t.p=="function"&&(o=t.p),n(t.r)&&(t.r=document.referrer),n(t.t)&&(t.t=document.title),n(t.p)&&(t.p=r()),s&&(t.r=s(t.r)),i&&(t.t=i(t.t)),o&&(t.p=o(t.p)),t},n=function(e){return e==null||typeof e=="function"},d=function(){var e=window,t=document;return e.callPhantom||e._phantom||e.phantom?150:e.__nightmare?151:t.__selenium_unwrapped||t.__webdriver_evaluate||t.__driver_evaluate?152:navigator.webdriver?153:0},u=function(t){var n,s=[];for(n in t)t[n]!==""&&t[n]!==null&&t[n]!==void 0&&t[n]!==!1&&s.push(e(n)+"="+e(t[n]));return"?"+s.join("&")},t=function(e){console&&"warn"in console&&console.warn("goatcounter: "+e)},a=function(){var e=document.querySelector("script[data-goatcounter]");return e&&e.dataset.goatcounter?e.dataset.goatcounter:goatcounter.endpoint||window.counter},r=function(){var e,t=location,n=document.querySelector('link[rel="canonical"][href]');return n&&(e=document.createElement("a"),e.href=n.href,e.hostname.replace(/^www\./,"")===location.hostname.replace(/^www\./,"")&&(t=e)),t.pathname+t.search||"/"},c=function(e){document.body===null?document.addEventListener("DOMContentLoaded",function(){e()},!1):e()},goatcounter.filter=function(){return"visibilityState"in document&&document.visibilityState==="prerender"?"visibilityState":!goatcounter.allow_frame&&location!==parent.location?"frame":!goatcounter.allow_local&&location.hostname.match(/(localhost$|^127\.|^10\.|^172\.(1[6-9]|2[0-9]|3[0-1])\.|^192\.168\.|^0\.0\.0\.0$)/)?"localhost":!goatcounter.allow_local&&location.protocol==="file:"?"localfile":!!(localStorage&&localStorage.getItem("skipgc")==="t")&&"disabled with #toggle-goatcounter"},window.goatcounter.url=function(e){var s,n=l(e||{});if(n.p===null)return;return n.rnd=Math.random().toString(36).substr(2,5),s=a(),s?s+u(n):t("no endpoint found")},window.goatcounter.count=function(e){var n,s,i,o=goatcounter.filter();if(o)return t("not counting because of: "+o);if(s=goatcounter.url(e),!s)return t("not counting because path callback returned null");n=document.createElement("img"),n.src=s,n.style.position="absolute",n.style.bottom="0px",n.style.width="1px",n.style.height="1px",n.loading="eager",n.setAttribute("alt",""),n.setAttribute("aria-hidden","true"),i=function(){n&&n.parentNode&&n.parentNode.removeChild(n)},n.addEventListener("load",i,!1),document.body.appendChild(n)},window.goatcounter.get_query=function(e){for(var n=location.search.substr(1).split("&"),t=0;t<n.length;t++)if(n[t].toLowerCase().indexOf(e.toLowerCase()+"=")===0)return n[t].substr(e.length+1)},window.goatcounter.bind_events=function(){if(!document.querySelectorAll)return;var e=function(e){return function(){goatcounter.count({event:!0,path:e.dataset.goatcounterClick||e.name||e.id||"",title:e.dataset.goatcounterTitle||e.title||(e.innerHTML||"").substr(0,200)||"",referrer:e.dataset.goatcounterReferrer||e.dataset.goatcounterReferral||""})}};Array.prototype.slice.call(document.querySelectorAll("*[data-goatcounter-click]")).forEach(function(t){if(t.dataset.goatcounterBound)return;var n=e(t);t.addEventListener("click",n,!1),t.addEventListener("auxclick",n,!1),t.dataset.goatcounterBound="true"})},window.goatcounter.visit_count=function(n){c(function(){n=n||{},n.type=n.type||"html",n.append=n.append||"body",n.path=n.path||r(),n.attr=n.attr||{width:"200",height:n.no_branding?"60":"80"},n.attr.src=a()+"er/"+e(n.path)+"."+e(n.type)+"?",n.no_branding&&(n.attr.src+="&no_branding=1"),n.style&&(n.attr.src+="&style="+e(n.style)),n.start&&(n.attr.src+="&start="+e(n.start)),n.end&&(n.attr.src+="&end="+e(n.end));var s,o,c,i={png:"img",svg:"img",html:"iframe"}[n.type];if(!i)return t("visit_count: unknown type: "+n.type);n.type==="html"&&(n.attr.frameborder="0",n.attr.scrolling="no"),s=document.createElement(i);for(c in n.attr)s.setAttribute(c,n.attr[c]);if(o=document.querySelector(n.append),!o)return t("visit_count: append not found: "+n.append);o.appendChild(s)})},location.hash==="#toggle-goatcounter"&&(localStorage.getItem("skipgc")==="t"?(localStorage.removeItem("skipgc","t"),alert("GoatCounter tracking is now ENABLED in this browser.")):(localStorage.setItem("skipgc","t"),alert("GoatCounter tracking is now DISABLED in this browser until "+location+" is loaded again."))),goatcounter.no_onload||c(function(){if(!("visibilityState"in document)||document.visibilityState==="visible")goatcounter.count();else{var e=function(){if(document.visibilityState!=="visible")return;document.removeEventListener("visibilitychange",e),goatcounter.count()};document.addEventListener("visibilitychange",e)}goatcounter.no_events||goatcounter.bind_events()})})()</script></body></html>